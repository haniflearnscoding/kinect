<!DOCTYPE html>
<html>
<head>
    <title>Gallery Face Recognition</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: monospace;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        #webcam-container {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #webcam-container canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        #person-name {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10vw;
            text-align: center;
            letter-spacing: 1vw;
            text-transform: uppercase;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
            z-index: 10;
            pointer-events: none;
        }
        
        #start-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px 80px;
            font-size: 30px;
            background: transparent;
            border: 3px solid #fff;
            color: #fff;
            cursor: pointer;
            letter-spacing: 5px;
            text-transform: uppercase;
            font-family: monospace;
            z-index: 100;
        }
        
        #start-button:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="webcam-container"></div>
    <div id="person-name"></div>
    <button id="start-button" onclick="init()">START</button>

    <script type="text/javascript">
        // REPLACE THIS WITH YOUR TEACHABLE MACHINE MODEL URL
        // 1. Go to: https://teachablemachine.withgoogle.com/train/image
        // 2. Create classes for "Person A" and "Person B"
        // 3. Upload/capture images for each person
        // 4. Train the model
        // 5. Export as "Tensorflow.js" â†’ "Upload my model"
        // 6. Copy the URL and paste it here:
        
        const URL = "https://teachablemachine.withgoogle.com/models/UD0v0RxfU/";
        
        let model, webcam, maxPredictions;

        async function init() {
            document.getElementById('start-button').classList.add('hidden');
            document.getElementById('person-name').innerHTML = 'LOADING...';
            
            try {
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";

                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                const flip = true;
                webcam = new tmImage.Webcam(window.innerWidth, window.innerHeight, flip);
                await webcam.setup();
                await webcam.play();
                
                document.getElementById("webcam-container").appendChild(webcam.canvas);
                document.getElementById('person-name').innerHTML = '';
                
                window.requestAnimationFrame(loop);
                
            } catch (error) {
                document.getElementById('person-name').innerHTML = 'ERROR<br>CHECK MODEL URL';
                console.error(error);
            }
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
    const prediction = await model.predict(webcam.canvas);
    
    let highestProb = 0;
    let detectedPerson = "";
    
    for (let i = 0; i < maxPredictions; i++) {
        if (prediction[i].probability > highestProb) {
            highestProb = prediction[i].probability;
            detectedPerson = prediction[i].className;
        }
    }
    
    const personName = document.getElementById('person-name');

    // Default state: show "DEFAULT" if confidence is low
    if (highestProb > 0.9) {
        personName.innerHTML = detectedPerson;
        personName.style.color = '#0f0';
        personName.style.opacity = '1';
    } else if (highestProb > 0.7) {
        personName.innerHTML = detectedPerson + '?';
        personName.style.color = '#ff0';
        personName.style.opacity = '0.8';
    } else {
        personName.innerHTML = 'DEFAULT';
        personName.style.color = '#888'; // dimmed color for default
        personName.style.opacity = '0.6';
    }
}

    </script>
</body>
</html>
